<div class="container py-4" *ngIf="ad">
  <div class="row">
    <div class="col-md-8">
      <div class="card mb-3">
        <div class="ad-images" *ngIf="ad.urlPhotos?.length">
          <img *ngFor="let photo of ad.urlPhotos" [src]="photo" class="img-fluid mb-2" />
        </div>

        <div class="card-body">
          <h3>{{ ad.title }}</h3>
          <p class="text-muted">{{ ad.city }}, {{ ad.country }} • {{ ad.address }}</p>
          <p>{{ ad.description }}</p>
          <div>
            <small>Sobe: {{ ad.numberOfRooms }} • Površina: {{ ad.homeArea }}</small>
            <br />
            <small>
              Dvorište: {{ ad.garden }} • Parking mesto: {{ ad.parkingSpace }} • Bazen:
              {{ ad.swimmingPool }}
            </small>
            <br />
            <small> Datum objavljivanja: {{ ad.date }}</small>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="currentUser?.id !== ad.homeOwnerId">
      <div class="col-md-4">
        <div
          *ngIf="reservationStatus"
          class="alert mt-2"
          [ngClass]="reservationStatus.isConfirmed ? 'alert-success' : 'alert-warning'"
        >
          {{ reservationStatus.message }}
        </div>

        <div class="card p-3 mb-3">
          <h6>Napravi rezervaciju</h6>

          <!-- Dodatno: prikaz zauzetih termina -->
          <div *ngIf="bookedPeriods?.length" class="mb-2">
            <strong>Zauzeti termini:</strong>
            <ul>
              <li *ngFor="let b of bookedPeriods">
                Od {{ b.startDate | date : 'dd.MM.yyyy HH:mm' }} do
                {{ b.endDate | date : 'dd.MM.yyyy HH:mm' }}
              </li>
            </ul>
          </div>

          <form [formGroup]="reservationForm">
            <div class="mb-2">
              <input
                type="datetime-local"
                class="form-control"
                formControlName="startDate"
                [min]="minDate | date : 'yyyy-MM-ddTHH:mm'"
              />
            </div>
            <div class="mb-2">
              <input
                type="datetime-local"
                class="form-control"
                formControlName="endDate"
                [min]="minDate | date : 'yyyy-MM-ddTHH:mm'"
              />
            </div>
          </form>
          <button class="btn btn-primary w-100" (click)="createReservation()">Rezerviši</button>
        </div>

        <div class="card p-3">
          <h6>Ostavi ocenu</h6>
          <form [formGroup]="ratingForm">
            <div class="mb-2">
              <select class="form-select" formControlName="score">
                <option *ngFor="let s of [1, 2, 3, 4, 5]" [value]="s">{{ s }}</option>
              </select>
            </div>
            <div class="mb-2">
              <textarea rows="3" class="form-control" formControlName="comment"></textarea>
            </div>
          </form>
          <button class="btn btn-secondary w-100" (click)="createRating()">Oceni</button>
        </div>
        <div class="card p-3 mt-3">
          <h6>Recenzije</h6>

          <div *ngIf="ratings.length > 0; else noRatings">
            <div *ngFor="let r of ratings" class="border p-2 mb-2 rounded">
              <p>⭐ {{ r.score }} / 5</p>
              <p>{{ r.comment }}</p>
              <small>Korisnik: {{ r.userId }}</small>
            </div>
          </div>

          <ng-template #noRatings>
            <p>Još nema recenzija za ovaj oglas.</p>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
</div>
